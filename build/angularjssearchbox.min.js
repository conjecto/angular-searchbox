"use strict";angular.module("angularjssearchbox",["mgcrea.ngStrap.typeahead","mgcrea.ngStrap.datepicker"]).directive("sbFocus",["$timeout",function(e){return function(t,s){e(function(){t.useKeywordFacet||s[0].focus()})}}]).directive("repeatDone",function(){return function(e,t){e.bindValueInput(t)}}).directive("searchBox",["$timeout",function(e){return{restrict:"A",templateUrl:"templates/searchBox.html",scope:{resultList:"=",facetList:"=",debug:"=?"},link:function(t,s){t.selected={key:"",value:""},t.selectedResult=null,t.debug=t.debug||!1,t.useKeywordFacet=!1,t.hasKeywordFacet=!1,t.sbResultList=t.resultList.slice(0);var i=[9,13,37,39];s.find("input").bind("keydown",function(u){-1!==i.indexOf(u.which)&&(u.preventDefault(),13===u.which?(t.useKeywordFacet=!0,e(function(){t.useKeywordFacet&&(t.selected.value="",t.hasKeywordFacet?t.sbResultList[t.sbResultList.length-1].value+=" "+t.selected.key:(t.hasKeywordFacet=!0,t.sbResultList.push({key:"text",type:"string",value:t.selected.key})),t.selected.key="",e(function(){t.resultList=t.sbResultList.slice(0),s.find("input")[s.find("input").length-1].focus(),t.selectedResult=null}))})):9===u.which&&t.$apply(function(){}))}),t.bindValueInput=function(u){e(function(){u.find("input").bind("keydown",function(e){-1!==i.indexOf(e.which)&&(e.preventDefault(),(13===e.which||9===e.which)&&(t.hasKeywordFacet&&t.$apply(function(){if("text"!=t.sbResultList[t.sbResultList.length-1].key){var e=t.sbResultList.pop();t.sbResultList.splice(t.sbResultList.length-1,0,e)}}),t.$apply(function(){t.resultList=t.sbResultList.slice(0),s.find("input")[s.find("input").length-1].focus(),t.selectedResult=null})))})})},t.getFacetLabel=function(e){for(var s in t.facetList)if(t.facetList[s].name==e)return t.facetList[s].label;return e},t.getValues=function(e){for(var s in t.facetList)if(t.facetList[s].name==e)return t.facetList[s].items;return[]},t.$on("$typeahead.select",function(i,u){t.$apply(function(){t.useKeywordFacet=!1,"object"==typeof u?(t.selected.value="",t.sbResultList.push({key:u.name,type:u.type,value:""}),t.selected.key=""):e(function(){if(t.hasKeywordFacet&&"text"!=t.sbResultList[t.sbResultList.length-1].key){var e=t.sbResultList.pop();t.sbResultList.splice(t.sbResultList.length-1,0,e)}t.resultList=t.sbResultList.slice(0),s.find("input")[s.find("input").length-1].focus(),t.selectedResult=null},100)})}),t.selectResult=function(e){t.selectedResult=e},t.removeFilter=function(e){"text"===t.sbResultList[e].key&&(t.hasKeywordFacet=!1),t.sbResultList.splice(e,1),t.resultList=t.sbResultList.slice(0)},t.removeAll=function(){t.hasKeywordFacet=!1,t.sbResultList.length=0,t.resultList.length=0}}}}]);
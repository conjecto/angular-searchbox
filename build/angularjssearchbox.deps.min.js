"use strict";angular.module("mgcrea.ngStrap.typeahead",["mgcrea.ngStrap.tooltip","mgcrea.ngStrap.helpers.parseOptions"]).provider("$typeahead",function(){var e=this.defaults={animation:"am-fade",prefixClass:"typeahead",placement:"bottom-left",template:"typeahead/typeahead.tpl.html",trigger:"focus",container:!1,keyboard:!0,html:!1,delay:0,minLength:1,filter:"filter",limit:6};this.$get=["$window","$rootScope","$tooltip",function(t,n,a){function i(t,n,i){var o={},r=angular.extend({},e,i);o=a(t,r);var s=i.scope,l=o.$scope;l.$resetMatches=function(){l.$matches=[],l.$activeIndex=0},l.$resetMatches(),l.$activate=function(e){l.$$postDigest(function(){o.activate(e)})},l.$select=function(e){l.$$postDigest(function(){o.select(e)})},l.$isVisible=function(){return o.$isVisible()},o.update=function(e){l.$matches=e,l.$activeIndex>=e.length&&(l.$activeIndex=0)},o.activate=function(e){l.$activeIndex=e},o.select=function(e){var t=l.$matches[e].value;n.$setViewValue(t),l.$resetMatches(),n.$render(),s&&s.$digest(),l.$emit("$typeahead.select",t,e)},o.$isVisible=function(){return r.minLength&&n?l.$matches.length&&angular.isString(n.$viewValue)&&n.$viewValue.length>=r.minLength:!!l.$matches.length},o.$getIndex=function(e){var t=l.$matches.length,n=t;if(t){for(n=t;n--&&l.$matches[n].value!==e;);if(!(0>n))return n}},o.$onMouseDown=function(e){e.preventDefault(),e.stopPropagation()},o.$onKeyDown=function(e){/(38|40|13)/.test(e.keyCode)&&(e.preventDefault(),e.stopPropagation(),13===e.keyCode&&l.$matches.length?o.select(l.$activeIndex):38===e.keyCode&&l.$activeIndex>0?l.$activeIndex--:40===e.keyCode&&l.$activeIndex<l.$matches.length-1?l.$activeIndex++:angular.isUndefined(l.$activeIndex)&&(l.$activeIndex=0),l.$digest())};var u=o.show;o.show=function(){u(),setTimeout(function(){o.$element.on("mousedown",o.$onMouseDown),r.keyboard&&t.on("keydown",o.$onKeyDown)})};var c=o.hide;return o.hide=function(){o.$element.off("mousedown",o.$onMouseDown),r.keyboard&&t.off("keydown",o.$onKeyDown),c()},o}return angular.element(t.document.body),i.defaults=e,i}]}).directive("bsTypeahead",["$window","$parse","$q","$typeahead","$parseOptions",function(e,t,n,a,i){var o=a.defaults;return{restrict:"EAC",require:"ngModel",link:function(e,t,n,r){var s={scope:e};angular.forEach(["placement","container","delay","trigger","keyboard","html","animation","template","filter","limit","minLength"],function(e){angular.isDefined(n[e])&&(s[e]=n[e])});var l=s.filter||o.filter,u=s.limit||o.limit,c=n.ngOptions;l&&(c+=" | "+l+":$viewValue"),u&&(c+=" | limitTo:"+u);var d=i(c),p=a(t,r,s);e.$watch(n.ngModel,function(t){e.$modelValue=t,d.valuesFn(e,r).then(function(e){e.length>u&&(e=e.slice(0,u)),(1!==e.length||e[0].value!==t)&&(p.update(e),r.$render())})}),r.$render=function(){if(r.$isEmpty(r.$viewValue))return t.val("");var e=p.$getIndex(r.$modelValue),n=angular.isDefined(e)?p.$scope.$matches[e].label:r.$viewValue;n=angular.isObject(n)?n.label:n,t.val(n.replace(/<(?:.|\n)*?>/gm,"").trim())},e.$on("$destroy",function(){p.destroy(),s=null,p=null})}}}]),angular.module("mgcrea.ngStrap.typeahead").run(["$templateCache",function(e){e.put("typeahead/typeahead.tpl.html",'<ul tabindex="-1" class="typeahead dropdown-menu" ng-show="$isVisible()" role="select"><li role="presentation" ng-repeat="match in $matches" ng-class="{active: $index == $activeIndex}"><a role="menuitem" tabindex="-1" ng-click="$select($index, $event)" ng-bind="match.label"></a></li></ul>')}]),angular.module("mgcrea.ngStrap.tooltip",["mgcrea.ngStrap.helpers.dimensions"]).provider("$tooltip",function(){var e=this.defaults={animation:"am-fade",prefixClass:"tooltip",prefixEvent:"tooltip",container:!1,placement:"top",template:"tooltip/tooltip.tpl.html",contentTemplate:!1,trigger:"hover focus",keyboard:!1,html:!1,show:!1,title:"",type:"",delay:0};this.$get=["$window","$rootScope","$compile","$q","$templateCache","$http","$animate","$timeout","dimensions","$$rAF",function(t,n,a,i,o,r,s,l,u,c){function d(t,i){function o(){return"body"===$.container?u.offset(t[0]):u.position(t[0])}function r(e,t,n,a){var i,o=e.split("-");switch(o[0]){case"right":i={top:t.top+t.height/2-a/2,left:t.left+t.width};break;case"bottom":i={top:t.top+t.height,left:t.left+t.width/2-n/2};break;case"left":i={top:t.top+t.height/2-a/2,left:t.left-n};break;default:i={top:t.top-a,left:t.left+t.width/2-n/2}}if(!o[1])return i;if("top"===o[0]||"bottom"===o[0])switch(o[1]){case"left":i.left=t.left;break;case"right":i.left=t.left+t.width-n}else if("left"===o[0]||"right"===o[0])switch(o[1]){case"top":i.top=t.top-a;break;case"bottom":i.top=t.top+t.height}return i}var l={},d=t[0].nodeName.toLowerCase(),$=l.$options=angular.extend({},e,i);l.$promise=f($.template);var y=l.$scope=$.scope&&$.scope.$new()||n.$new();$.delay&&angular.isString($.delay)&&($.delay=parseFloat($.delay)),$.title&&(l.$scope.title=$.title),y.$hide=function(){y.$$postDigest(function(){l.hide()})},y.$show=function(){y.$$postDigest(function(){l.show()})},y.$toggle=function(){y.$$postDigest(function(){l.toggle()})},l.$isShown=y.$isShown=!1;var v,w;$.contentTemplate&&(l.$promise=l.$promise.then(function(e){var t=angular.element(e);return f($.contentTemplate).then(function(e){var n=p('[ng-bind="content"]',t[0]);return n.length||(n=p('[ng-bind="title"]',t[0])),n.removeAttr("ng-bind").html(e),t[0].outerHTML})}));var b,D,M,k;return l.$promise.then(function(e){angular.isObject(e)&&(e=e.data),$.html&&(e=e.replace(m,'ng-bind-html="')),e=h.apply(e),M=e,b=a(e),l.init()}),l.init=function(){$.delay&&angular.isNumber($.delay)&&($.delay={show:$.delay,hide:$.delay}),"self"===$.container?k=t:$.container&&(k=p($.container));var e=$.trigger.split(" ");angular.forEach(e,function(e){"click"===e?t.on("click",l.toggle):"manual"!==e&&(t.on("hover"===e?"mouseenter":"focus",l.enter),t.on("hover"===e?"mouseleave":"blur",l.leave),"button"===d&&"hover"!==e&&t.on(g?"touchstart":"mousedown",l.$onFocusElementMouseDown))}),$.show&&y.$$postDigest(function(){"focus"===$.trigger?t[0].focus():l.show()})},l.destroy=function(){for(var e=$.trigger.split(" "),n=e.length;n--;){var a=e[n];"click"===a?t.off("click",l.toggle):"manual"!==a&&(t.off("hover"===a?"mouseenter":"focus",l.enter),t.off("hover"===a?"mouseleave":"blur",l.leave),"button"===d&&"hover"!==a&&t.off(g?"touchstart":"mousedown",l.$onFocusElementMouseDown))}D&&(D.remove(),D=null),y.$destroy()},l.enter=function(){return clearTimeout(v),w="in",$.delay&&$.delay.show?void(v=setTimeout(function(){"in"===w&&l.show()},$.delay.show)):l.show()},l.show=function(){y.$emit($.prefixEvent+".show.before",l);var e=$.container?k:null,n=$.container?null:t;D&&D.remove(),D=l.$element=b(y,function(){}),D.css({top:"0px",left:"0px",display:"block"}).addClass($.placement),$.animation&&D.addClass($.animation),$.type&&D.addClass($.prefixClass+"-"+$.type),s.enter(D,e,n,function(){y.$emit($.prefixEvent+".show",l)}),l.$isShown=y.$isShown=!0,y.$$phase||y.$root.$$phase||y.$digest(),c(l.$applyPlacement),$.keyboard&&("focus"!==$.trigger?(l.focus(),D.on("keyup",l.$onKeyUp)):t.on("keyup",l.$onFocusKeyUp))},l.leave=function(){return clearTimeout(v),w="out",$.delay&&$.delay.hide?void(v=setTimeout(function(){"out"===w&&l.hide()},$.delay.hide)):l.hide()},l.hide=function(e){return l.$isShown?(y.$emit($.prefixEvent+".hide.before",l),s.leave(D,function(){y.$emit($.prefixEvent+".hide",l)}),l.$isShown=y.$isShown=!1,y.$$phase||y.$root.$$phase||y.$digest(),$.keyboard&&null!==D&&D.off("keyup",l.$onKeyUp),e&&"focus"===$.trigger?t[0].blur():void 0):void 0},l.toggle=function(){l.$isShown?l.leave():l.enter()},l.focus=function(){D[0].focus()},l.$applyPlacement=function(){if(D){var e=o(),t=D.prop("offsetWidth"),n=D.prop("offsetHeight"),a=r($.placement,e,t,n);a.top+="px",a.left+="px",D.css(a)}},l.$onKeyUp=function(e){27===e.which&&l.hide()},l.$onFocusKeyUp=function(e){27===e.which&&t[0].blur()},l.$onFocusElementMouseDown=function(e){e.preventDefault(),e.stopPropagation(),l.$isShown?t[0].blur():t[0].focus()},l}function p(e,t){return angular.element((t||document).querySelectorAll(e))}function f(e){return i.when(o.get(e)||r.get(e)).then(function(t){return angular.isObject(t)?(o.put(e,t.data),t.data):t})}var h=String.prototype.trim,g="createTouch"in t.document,m=/ng-bind="/gi;return d}]}).directive("bsTooltip",["$window","$location","$sce","$tooltip","$$rAF",function(e,t,n,a,i){return{restrict:"EAC",scope:!0,link:function(e,t,o){var r={scope:e};angular.forEach(["template","contentTemplate","placement","container","delay","trigger","keyboard","html","animation","type"],function(e){angular.isDefined(o[e])&&(r[e]=o[e])}),angular.forEach(["title"],function(t){o[t]&&o.$observe(t,function(a,o){e[t]=n.trustAsHtml(a),angular.isDefined(o)&&i(function(){s&&s.$applyPlacement()})})}),o.bsTooltip&&e.$watch(o.bsTooltip,function(t,n){angular.isObject(t)?angular.extend(e,t):e.title=t,angular.isDefined(n)&&i(function(){s&&s.$applyPlacement()})},!0);var s=a(t,r);e.$on("$destroy",function(){s.destroy(),r=null,s=null})}}}]),angular.module("mgcrea.ngStrap.tooltip").run(["$templateCache",function(e){e.put("tooltip/tooltip.tpl.html",'<div class="tooltip in" ng-show="title"><div class="tooltip-arrow"></div><div class="tooltip-inner" ng-bind="title"></div></div>')}]),angular.module("mgcrea.ngStrap.helpers.parseOptions",[]).provider("$parseOptions",function(){var e=this.defaults={regexp:/^\s*(.*?)(?:\s+as\s+(.*?))?(?:\s+group\s+by\s+(.*))?\s+for\s+(?:([\$\w][\$\w]*)|(?:\(\s*([\$\w][\$\w]*)\s*,\s*([\$\w][\$\w]*)\s*\)))\s+in\s+(.*?)(?:\s+track\s+by\s+(.*?))?$/};this.$get=["$parse","$q",function(t,n){function a(a,i){function o(e,t){return e.map(function(e,n){var a,i,o={};return o[c]=e,a=u(t,o),i=f(t,o)||n,{label:a,value:i}})}var r={},s=angular.extend({},e,i);r.$values=[];var l,u,c,d,p,f,h;return r.init=function(){r.$match=l=a.match(s.regexp),u=t(l[2]||l[1]),c=l[4]||l[6],d=l[5],p=t(l[3]||""),f=t(l[2]?l[1]:c),h=t(l[7])},r.valuesFn=function(e,t){return n.when(h(e,t)).then(function(t){return r.$values=t?o(t,e):{},r.$values})},r.init(),r}return a}]}),angular.module("mgcrea.ngStrap.helpers.dimensions",[]).factory("dimensions",["$document","$window",function(){var e=(angular.element,{}),t=e.nodeName=function(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()};e.css=function(e,t,n){var a;return a=e.currentStyle?e.currentStyle[t]:window.getComputedStyle?window.getComputedStyle(e)[t]:e.style[t],n===!0?parseFloat(a)||0:a},e.offset=function(e){var t=e.getBoundingClientRect(),n=e.ownerDocument;return{width:e.offsetWidth,height:e.offsetHeight,top:t.top+(window.pageYOffset||n.documentElement.scrollTop)-(n.documentElement.clientTop||0),left:t.left+(window.pageXOffset||n.documentElement.scrollLeft)-(n.documentElement.clientLeft||0)}},e.position=function(a){var i,o,r={top:0,left:0};return"fixed"===e.css(a,"position")?o=a.getBoundingClientRect():(i=n(a),o=e.offset(a),o=e.offset(a),t(i,"html")||(r=e.offset(i)),r.top+=e.css(i,"borderTopWidth",!0),r.left+=e.css(i,"borderLeftWidth",!0)),{width:a.offsetWidth,height:a.offsetHeight,top:o.top-r.top-e.css(a,"marginTop",!0),left:o.left-r.left-e.css(a,"marginLeft",!0)}};var n=function(n){var a=n.ownerDocument,i=n.offsetParent||a;if(t(i,"#document"))return a.documentElement;for(;i&&!t(i,"html")&&"static"===e.css(i,"position");)i=i.offsetParent;return i||a.documentElement};return e.height=function(t,n){var a=t.offsetHeight;return n?a+=e.css(t,"marginTop",!0)+e.css(t,"marginBottom",!0):a-=e.css(t,"paddingTop",!0)+e.css(t,"paddingBottom",!0)+e.css(t,"borderTopWidth",!0)+e.css(t,"borderBottomWidth",!0),a},e.width=function(t,n){var a=t.offsetWidth;return n?a+=e.css(t,"marginLeft",!0)+e.css(t,"marginRight",!0):a-=e.css(t,"paddingLeft",!0)+e.css(t,"paddingRight",!0)+e.css(t,"borderLeftWidth",!0)+e.css(t,"borderRightWidth",!0),a},e}]),angular.module("mgcrea.ngStrap.datepicker",["mgcrea.ngStrap.helpers.dateParser","mgcrea.ngStrap.tooltip"]).provider("$datepicker",function(){var e=this.defaults={animation:"am-fade",prefixClass:"datepicker",placement:"bottom-left",template:"datepicker/datepicker.tpl.html",trigger:"focus",container:!1,keyboard:!0,html:!1,delay:0,useNative:!1,dateType:"date",dateFormat:"shortDate",dayFormat:"dd",strictFormat:!1,autoclose:!1,minDate:-1/0,maxDate:1/0,startView:0,minView:0,startWeek:0};this.$get=["$window","$document","$rootScope","$sce","$locale","dateFilter","datepickerViews","$tooltip",function(t,n,a,i,o,r,s,l){function u(t,n,a){function i(e){e.selected=r.$isSelected(e.date)}function o(){t[0].focus()}var r=l(t,angular.extend({},e,a)),u=a.scope,p=r.$options,f=r.$scope;p.startView&&(p.startView-=p.minView);var h=s(r);r.$views=h.views;var g=h.viewDate;f.$mode=p.startView;var m=r.$views[f.$mode];f.$select=function(e){r.select(e)},f.$selectPane=function(e){r.$selectPane(e)},f.$toggleMode=function(){r.setMode((f.$mode+1)%r.$views.length)},r.update=function(e){angular.isDate(e)&&!isNaN(e.getTime())&&(r.$date=e,m.update.call(m,e)),r.$build(!0)},r.select=function(e,t){angular.isDate(n.$dateValue)||(n.$dateValue=new Date(e)),n.$dateValue.setFullYear(e.getFullYear(),e.getMonth(),e.getDate()),!f.$mode||t?(n.$setViewValue(n.$dateValue),n.$render(),p.autoclose&&!t&&r.hide(!0)):(angular.extend(g,{year:e.getFullYear(),month:e.getMonth(),date:e.getDate()}),r.setMode(f.$mode-1),r.$build())},r.setMode=function(e){f.$mode=e,m=r.$views[f.$mode],r.$build()},r.$build=function(e){e===!0&&m.built||(e!==!1||m.built)&&m.build.call(m)},r.$updateSelected=function(){for(var e=0,t=f.rows.length;t>e;e++)angular.forEach(f.rows[e],i)},r.$isSelected=function(e){return m.isSelected(e)},r.$selectPane=function(e){var t=m.steps,n=new Date(Date.UTC(g.year+(t.year||0)*e,g.month+(t.month||0)*e,g.date+(t.day||0)*e));angular.extend(g,{year:n.getUTCFullYear(),month:n.getUTCMonth(),date:n.getUTCDate()}),r.$build()},r.$onMouseDown=function(e){if(e.preventDefault(),e.stopPropagation(),c){var t=angular.element(e.target);"button"!==t[0].nodeName.toLowerCase()&&(t=t.parent()),t.triggerHandler("click")}},r.$onKeyDown=function(e){if(/(38|37|39|40|13)/.test(e.keyCode)&&!e.shiftKey&&!e.altKey){if(e.preventDefault(),e.stopPropagation(),13===e.keyCode)return f.$mode?f.$apply(function(){r.setMode(f.$mode-1)}):r.hide(!0);m.onKeyDown(e),u.$digest()}};var $=r.init;r.init=function(){return d&&p.useNative?(t.prop("type","date"),void t.css("-webkit-appearance","textfield")):(c&&(t.prop("type","text"),t.attr("readonly","true"),t.on("click",o)),void $())};var y=r.destroy;r.destroy=function(){d&&p.useNative&&t.off("click",o),y()};var v=r.show;r.show=function(){v(),setTimeout(function(){r.$element.on(c?"touchstart":"mousedown",r.$onMouseDown),p.keyboard&&t.on("keydown",r.$onKeyDown)})};var w=r.hide;return r.hide=function(e){r.$element.off(c?"touchstart":"mousedown",r.$onMouseDown),p.keyboard&&t.off("keydown",r.$onKeyDown),w(e)},r}var c=(angular.element(t.document.body),"createTouch"in t.document),d=/(ip(a|o)d|iphone|android)/gi.test(t.navigator.userAgent);return e.lang||(e.lang=o.id),u.defaults=e,u}]}).directive("bsDatepicker",["$window","$parse","$q","$locale","dateFilter","$datepicker","$dateParser","$timeout",function(e,t,n,a,i,o,r){var s=(o.defaults,/(ip(a|o)d|iphone|android)/gi.test(e.navigator.userAgent)),l=function(e){return!isNaN(parseFloat(e))&&isFinite(e)};return{restrict:"EAC",require:"ngModel",link:function(e,t,n,a){var u={scope:e,controller:a};angular.forEach(["placement","container","delay","trigger","keyboard","html","animation","template","autoclose","dateType","dateFormat","dayFormat","strictFormat","startWeek","useNative","lang","startView","minView"],function(e){angular.isDefined(n[e])&&(u[e]=n[e])}),s&&u.useNative&&(u.dateFormat="yyyy-MM-dd");var c=o(t,a,u);u=c.$options,angular.forEach(["minDate","maxDate"],function(e){angular.isDefined(n[e])&&n.$observe(e,function(t){if("today"===t){var n=new Date;c.$options[e]=+new Date(n.getFullYear(),n.getMonth(),n.getDate()+("maxDate"===e?1:0),0,0,0,"minDate"===e?0:-1)}else c.$options[e]=angular.isString(t)&&t.match(/^".+"$/)?+new Date(t.substr(1,t.length-2)):l(t)?+new Date(parseInt(t,10)):+new Date(t);!isNaN(c.$options[e])&&c.$build(!1)})}),e.$watch(n.ngModel,function(){c.update(a.$dateValue)},!0);var d=r({format:u.dateFormat,lang:u.lang,strict:u.strictFormat});a.$parsers.unshift(function(e){if(!e)return void a.$setValidity("date",!0);var t=d.parse(e,a.$dateValue);if(!t||isNaN(t.getTime()))return void a.$setValidity("date",!1);var n=(isNaN(c.$options.minDate)||t.getTime()>=c.$options.minDate)&&(isNaN(c.$options.maxDate)||t.getTime()<=c.$options.maxDate);return a.$setValidity("date",n),n&&(a.$dateValue=t),"string"===u.dateType?i(e,u.dateFormat):"number"===u.dateType?a.$dateValue.getTime():"iso"===u.dateType?a.$dateValue.toISOString():new Date(a.$dateValue)}),a.$formatters.push(function(e){var t;return t=angular.isUndefined(e)||null===e?0/0:angular.isDate(e)?e:"string"===u.dateType?d.parse(e):new Date(e),a.$dateValue=t,a.$dateValue}),a.$render=function(){t.val(!a.$dateValue||isNaN(a.$dateValue.getTime())?"":i(a.$dateValue,u.dateFormat))},e.$on("$destroy",function(){c.destroy(),u=null,c=null})}}}]).provider("datepickerViews",function(){function e(e,t){for(var n=[];e.length>0;)n.push(e.splice(0,t));return n}function t(e,t){return(e%t+t)%t}this.defaults={dayFormat:"dd",daySplit:7},this.$get=["$locale","$sce","dateFilter",function(n,a,i){return function(o){var r=o.$scope,s=o.$options,l=n.DATETIME_FORMATS.SHORTDAY,u=l.slice(s.startWeek).concat(l.slice(0,s.startWeek)),c=a.trustAsHtml('<th class="dow text-center">'+u.join('</th><th class="dow text-center">')+"</th>"),d=o.$date||new Date,p={year:d.getFullYear(),month:d.getMonth(),date:d.getDate()},f=(6e4*d.getTimezoneOffset(),[{format:s.dayFormat,split:7,steps:{month:1},update:function(e,t){!this.built||t||e.getFullYear()!==p.year||e.getMonth()!==p.month?(angular.extend(p,{year:o.$date.getFullYear(),month:o.$date.getMonth(),date:o.$date.getDate()}),o.$build()):e.getDate()!==p.date&&(p.date=o.$date.getDate(),o.$updateSelected())},build:function(){var n=new Date(p.year,p.month,1),a=n.getTimezoneOffset(),l=new Date(+n-864e5*t(n.getDay()-s.startWeek,7)),u=l.getTimezoneOffset();u!==a&&(l=new Date(+l+6e4*(u-a)));for(var d,f=[],h=0;42>h;h++)d=new Date(l.getFullYear(),l.getMonth(),l.getDate()+h),f.push({date:d,label:i(d,this.format),selected:o.$date&&this.isSelected(d),muted:d.getMonth()!==p.month,disabled:this.isDisabled(d)});r.title=i(n,"MMMM yyyy"),r.showLabels=!0,r.labels=c,r.rows=e(f,this.split),this.built=!0},isSelected:function(e){return o.$date&&e.getFullYear()===o.$date.getFullYear()&&e.getMonth()===o.$date.getMonth()&&e.getDate()===o.$date.getDate()},isDisabled:function(e){return e.getTime()<s.minDate||e.getTime()>s.maxDate},onKeyDown:function(e){var t,n=o.$date.getTime();37===e.keyCode?t=new Date(n-864e5):38===e.keyCode?t=new Date(n-6048e5):39===e.keyCode?t=new Date(n+864e5):40===e.keyCode&&(t=new Date(n+6048e5)),this.isDisabled(t)||o.select(t,!0)}},{name:"month",format:"MMM",split:4,steps:{year:1},update:function(e){this.built&&e.getFullYear()===p.year?e.getMonth()!==p.month&&(angular.extend(p,{month:o.$date.getMonth(),date:o.$date.getDate()}),o.$updateSelected()):(angular.extend(p,{year:o.$date.getFullYear(),month:o.$date.getMonth(),date:o.$date.getDate()}),o.$build())},build:function(){for(var t,n=(new Date(p.year,0,1),[]),a=0;12>a;a++)t=new Date(p.year,a,1),n.push({date:t,label:i(t,this.format),selected:o.$isSelected(t),disabled:this.isDisabled(t)});r.title=i(t,"yyyy"),r.showLabels=!1,r.rows=e(n,this.split),this.built=!0},isSelected:function(e){return o.$date&&e.getFullYear()===o.$date.getFullYear()&&e.getMonth()===o.$date.getMonth()},isDisabled:function(e){var t=+new Date(e.getFullYear(),e.getMonth()+1,0);return t<s.minDate||e.getTime()>s.maxDate},onKeyDown:function(e){var t=o.$date.getMonth(),n=new Date(o.$date);37===e.keyCode?n.setMonth(t-1):38===e.keyCode?n.setMonth(t-4):39===e.keyCode?n.setMonth(t+1):40===e.keyCode&&n.setMonth(t+4),this.isDisabled(n)||o.select(n,!0)}},{name:"year",format:"yyyy",split:4,steps:{year:12},update:function(e,t){!this.built||t||parseInt(e.getFullYear()/20,10)!==parseInt(p.year/20,10)?(angular.extend(p,{year:o.$date.getFullYear(),month:o.$date.getMonth(),date:o.$date.getDate()}),o.$build()):e.getFullYear()!==p.year&&(angular.extend(p,{year:o.$date.getFullYear(),month:o.$date.getMonth(),date:o.$date.getDate()}),o.$updateSelected())},build:function(){for(var t,n=p.year-p.year%(3*this.split),a=[],s=0;12>s;s++)t=new Date(n+s,0,1),a.push({date:t,label:i(t,this.format),selected:o.$isSelected(t),disabled:this.isDisabled(t)});r.title=a[0].label+"-"+a[a.length-1].label,r.showLabels=!1,r.rows=e(a,this.split),this.built=!0},isSelected:function(e){return o.$date&&e.getFullYear()===o.$date.getFullYear()},isDisabled:function(e){var t=+new Date(e.getFullYear()+1,0,0);return t<s.minDate||e.getTime()>s.maxDate},onKeyDown:function(e){var t=o.$date.getFullYear(),n=new Date(o.$date);37===e.keyCode?n.setYear(t-1):38===e.keyCode?n.setYear(t-4):39===e.keyCode?n.setYear(t+1):40===e.keyCode&&n.setYear(t+4),this.isDisabled(n)||o.select(n,!0)}}]);return{views:s.minView?Array.prototype.slice.call(f,s.minView):f,viewDate:p}}}]}),angular.module("mgcrea.ngStrap.helpers.dateParser",[]).provider("$dateParser",["$localeProvider",function(){var e=Date.prototype,t=this.defaults={format:"shortDate",strict:!1};this.$get=["$locale",function(n){var a=function(a){function i(e){var t,n=Object.keys(p),a=[],i=[],o=e;for(t=0;t<n.length;t++)if(e.split(n[t]).length>1){var r=o.search(n[t]);e=e.split(n[t]).join(""),p[n[t]]&&(a[r]=p[n[t]])}return angular.forEach(a,function(e){i.push(e)}),i}function o(e){return e.replace(/\//g,"[\\/]").replace("/-/g","[-]").replace(/\./g,"[.]").replace(/\\s/g,"[\\s]")}function r(e){var t,n=Object.keys(d),a=e;for(t=0;t<n.length;t++)a=a.split(n[t]).join("${"+t+"}");for(t=0;t<n.length;t++)a=a.split("${"+t+"}").join("("+d[n[t]]+")");return e=o(e),new RegExp("^"+a+"$",["i"])}var s,l,u=angular.extend({},t,a),c={},d={sss:"[0-9]{3}",ss:"[0-5][0-9]",s:u.strict?"[1-5]?[0-9]":"[0-9]|[0-5][0-9]",mm:"[0-5][0-9]",m:u.strict?"[1-5]?[0-9]":"[0-9]|[0-5][0-9]",HH:"[01][0-9]|2[0-3]",H:u.strict?"1?[0-9]|2[0-3]":"[01]?[0-9]|2[0-3]",hh:"[0][1-9]|[1][012]",h:u.strict?"[1-9]|1[012]":"0?[1-9]|1[012]",a:"AM|PM",EEEE:n.DATETIME_FORMATS.DAY.join("|"),EEE:n.DATETIME_FORMATS.SHORTDAY.join("|"),dd:"0[1-9]|[12][0-9]|3[01]",d:u.strict?"[1-9]|[1-2][0-9]|3[01]":"0?[1-9]|[1-2][0-9]|3[01]",MMMM:n.DATETIME_FORMATS.MONTH.join("|"),MMM:n.DATETIME_FORMATS.SHORTMONTH.join("|"),MM:"0[1-9]|1[012]",M:u.strict?"[1-9]|1[012]":"0?[1-9]|1[012]",yyyy:"[1]{1}[0-9]{3}|[2]{1}[0-9]{3}",yy:"[0-9]{2}",y:u.strict?"-?(0|[1-9][0-9]{0,3})":"-?0*[0-9]{1,4}"},p={sss:e.setMilliseconds,ss:e.setSeconds,s:e.setSeconds,mm:e.setMinutes,m:e.setMinutes,HH:e.setHours,H:e.setHours,hh:e.setHours,h:e.setHours,dd:e.setDate,d:e.setDate,a:function(e){var t=this.getHours();return this.setHours(e.match(/pm/i)?t+12:t)},MMMM:function(e){return this.setMonth(n.DATETIME_FORMATS.MONTH.indexOf(e))},MMM:function(e){return this.setMonth(n.DATETIME_FORMATS.SHORTMONTH.indexOf(e))},MM:function(e){return this.setMonth(1*e-1)},M:function(e){return this.setMonth(1*e-1)},yyyy:e.setFullYear,yy:function(e){return this.setFullYear(2e3+1*e)},y:e.setFullYear};return c.init=function(){c.$format=n.DATETIME_FORMATS[u.format]||u.format,s=r(c.$format),l=i(c.$format)},c.isValid=function(e){return angular.isDate(e)?!isNaN(e.getTime()):s.test(e)},c.parse=function(e,t){if(angular.isDate(e))return e;var n=s.exec(e);if(!n)return!1;for(var a=t||new Date(0,0,1),i=0;i<n.length-1;i++)l[i]&&l[i].call(a,n[i+1]);return a},c.init(),c};return a}]}]),angular.module("angularjssearchbox",["mgcrea.ngStrap.typeahead","mgcrea.ngStrap.datepicker"]).directive("sbFocus",["$timeout",function(e){return function(t,n){e(function(){t.useKeywordFacet||n[0].value||n[0].focus()})}}]).directive("repeatDone",function(){return function(e,t){e.bindValueInput(t)}}).directive("searchBox",["$timeout",function(e){return{restrict:"A",templateUrl:"templates/searchBox.html",scope:{resultList:"=",facetList:"=",debug:"=?"},link:function(t,n){e(function(){t.selected={key:"",value:""}}),t.tmpInputValue=null,t.selectedResult=null,t.debug=t.debug||!1,t.useKeywordFacet=!1,t.hasKeywordFacet=!1,t.sbResultList=t.resultList.slice(0);var a=[9,13,37,39];n.find("input").bind("keydown",function(i){-1!==a.indexOf(i.which)&&(i.preventDefault(),13===i.which?(t.useKeywordFacet=!0,e(function(){t.useKeywordFacet&&(t.selected.value="",t.hasKeywordFacet?t.sbResultList[t.sbResultList.length-1].value+=" "+t.selected.key:(t.hasKeywordFacet=!0,t.sbResultList.push({key:"text",type:"string",value:t.selected.key})),t.selected.key="",e(function(){t.resultList=t.sbResultList.slice(0),n.find("input")[n.find("input").length-1].focus(),t.selectedResult=null}))})):9===i.which&&t.$apply(function(){}))}),t.bindValueInput=function(i){e(function(){i.find("input").bind("keydown",function(e){-1!==a.indexOf(e.which)&&(e.preventDefault(),(13===e.which||9===e.which)&&(t.hasKeywordFacet&&t.$apply(function(){if("text"!=t.sbResultList[t.sbResultList.length-1].key){var e=t.sbResultList.pop();t.sbResultList.splice(t.sbResultList.length-1,0,e)}}),t.$apply(function(){t.resultList=t.sbResultList.slice(0),n.find("input")[n.find("input").length-1].focus(),t.selectedResult=null})))})})},t.selectInputFacet=function(){n.find("input")[n.find("input").length-1].focus()},t.getFacetLabel=function(e){for(var n in t.facetList)if(t.facetList[n].name==e)return t.facetList[n].label;return e},t.getValues=function(e){for(var n in t.facetList)if(t.facetList[n].name==e)return t.facetList[n].items;return[]},t.$on("$typeahead.select",function(a,i){t.$apply(function(){t.useKeywordFacet=!1,"object"==typeof i?(t.selected.value="",t.sbResultList.push({key:i.name,type:i.type,value:""}),t.selected.key=""):e(function(){if(t.hasKeywordFacet&&"text"!=t.sbResultList[t.sbResultList.length-1].key){var e=t.sbResultList.pop();t.sbResultList.splice(t.sbResultList.length-1,0,e)}t.resultList=t.sbResultList.slice(0),n.find("input")[n.find("input").length-1].focus(),t.selectedResult=null},100)})}),t.selectResult=function(e){t.selectedResult=e},t.removeFilter=function(e){"text"===t.sbResultList[e].key&&(t.hasKeywordFacet=!1),t.sbResultList.splice(e,1),t.resultList=t.sbResultList.slice(0)},t.removeAll=function(){t.hasKeywordFacet=!1,t.sbResultList.length=0,t.resultList.length=0}}}}]),angular.module("angularjssearchbox").run(["$templateCache",function(e){e.put("templates/searchBox.html",'<pre ng-show="debug">Model: {{selected.key | json}} Value : {{ selected.value | json}} opened : {{ opened }}</pre>\r\n<div class="SB-search">\r\n    <div class="SB-search-box-wrapper form-control SB-search-box ">\r\n        <div class="SB-icon SB-icon-search"><span class="glyphicon glyphicon-search"></span></div>\r\n        <div class="SB-placeholder" ng-click="selectInputFacet()"></div>\r\n        <div class="SB-search-inner" >\r\n            <div class="search_parameter" ng-class="{ selected : $index == selectedResult }"\r\n                 ng-repeat="parameter in sbResultList" ng-click="selectResult($index)"\r\n                 repeat-done="test()">\r\n                <div class="search_parameter_remove SB-icon SB-icon-cancel" ng-click="removeFilter($index)"><span class="glyphicon glyphicon-remove"></span></div>\r\n                <div class="key">{{ getFacetLabel(parameter.key) }}</div>\r\n                <div class="value" ><span style="position:relative;z-index:1;display:inline-block;visibility: hidden;" >{{ parameter.value }}</span>\r\n                <input type="text"\r\n                       ng-model="parameter.value"\r\n                       ng-if="(parameter.type == null || parameter.type == \'string\')"\r\n                       class="form-control"\r\n                       limit="8"\r\n                       data-trigger="focus"\r\n                       data-min-length="0"\r\n                       style="position:absolute;z-index:2;width:100%;font-size:1em;top:0px;"\r\n                       value="{{ parameter.value }}"\r\n                       data-container="body"\r\n                       ng-options="element.name as element.name + \' (\' +element.count+\')\' for element in getValues(parameter.key) | filter:{name:$viewValue}"\r\n                       sb-focus bs-typeahead>\r\n                <input type="text"\r\n                       ng-model="parameter.value"\r\n                       ng-if="parameter.type == \'date\'"\r\n                       class="form-control"\r\n                       data-date-format="dd-MM-yyyy"\r\n                       data-container="body"\r\n                       style="position:absolute;z-index:2;width:100%;font-size:1em;top:0px;"\r\n                       data-autoclose="1"\r\n                       bs-datepicker\r\n                       sb-focus>\r\n\r\n                </div>\r\n            </div>\r\n            <div class="search_parameter">\r\n            <input input-facet\r\n                   data-min-length="0"\r\n                   type="text"\r\n                   ng-model="selected.key"\r\n                   data-limit="8"\r\n                   data-trigger="focus"\r\n                   data-container="body"\r\n                   data-delay="{ show: 500, hide: 0 }"\r\n                   ng-options="element as element.label for element in facetList | filter:{label:$viewValue}"\r\n                   class="form-control input-facet" bs-typeahead>\r\n            </div>\r\n\r\n        </div>\r\n        <div class="SB-icon SB-icon-cancel SB-cancel-search-box" title="clear search" ng-click="removeAll()"><span class="glyphicon glyphicon-remove-circle"></span></div>\r\n    </div>\r\n</div>\r\n<pre ng-show="debug" style="margin-top: 10px;">sbResultList: {{sbResultList | json}} </pre>\r\n<pre ng-show="debug">resultList (input/output): {{resultList | json}} </pre>\r\n<pre ng-show="debug">facetList (input): {{facetList | json}} </pre>\r\n')}]);